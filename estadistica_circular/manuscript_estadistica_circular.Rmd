---
title: "Estadística circular aplicada a la Ecología\n"
  
author: Irene Mendoza^1^

csl: ecosistemas.csl  
output:
    word_document:
    fig_caption: yes
    fig_height: 8
    fig_width: 10
    highlight: null
    reference_docx: estadistica_circular.docx
    
bibliography: 
  - references_estadistica_circular.bib
  - knitcitations_estadistica_circular.bib
---


> (1) Departamento de Ecología Integrativa. Estación Biológica de Doñana (CSIC).

> Autor para correspondencia: Irene Mendoza [irene.mendoza@ebd.csic.es]


## Palabras clave

> fenología; actividad diaria; test de Rayleigh; test de Mardia-Watson-Wheeler


## Keywords

> phenology; diel activity; Rayleigh test; test de Mardia-Watson-Wheeler


```{r knitcitations, echo=FALSE, cache = FALSE, warning = FALSE}
library(knitcitations)
library(RefManageR)
library(bibtex)
cleanbib()   
cite_options(citation_format = "pandoc")
```



La estadística circular es una poderosa herramienta que permite analizar de forma apropiada variables que tienen una naturaleza cíclica y para los que la estadística linear no es correcta. Algunos ejemplos clásicos en Ecología incluyen el estudio de diferentes momentos de la floración o fructificación de una especie a lo largo del año, los patrones de actividad diarios de un mamífero, o las direcciones de vuelo de las mariposas. En estos casos, es importante destacar que la designación de un cero es completamente arbitraria y, por consiguiente, también la de valores mayores o menores. Por ejemplo, la diferencia entre el mes de enero y diciembre es de solo un mes en una escala circular, mientras que en una escala linear, dicha diferencia sería de 12 meses.

# Transformación de nuestra variable de naturaleza circular en ángulos
La primera medida que debemos hacer con nuestros datos de naturaleza circular es convertirlos en ángulos. Esto es fácilmente realizable con una simple ecuación [@Zar1999]: 


$$
a = \frac{(360º)(X)}{k}
$$
En la que *X* representa la variable temporal que queremos convertir en una dirección angular (en grados) y *k* es la cantidad total de unidades de tiempo de nuestra circunferencia (*k* = 365 para días del año, o *k* = 12 para meses, por ejemplo). De esta manera, el 14 de febrero, que es el día 45º del año, corresponde a 

```{r ejemplo14feb, eval = TRUE, echo = TRUE}
a <- 360*45/365
```
`r round(a, 2)` grados. En el caso de medidas mensuales, los 360º se dividen en 12 sectores de 30º. Por convención, se considera el punto medio del sector como el correspondiente a cada mes, es decir 15º para enero, 45º para febrero, ... y 345º para diciembre. 

# Ejemplos usados y esquema de la nota
En esta nota, vamos a usar dos ejemplos muy sencillos, uno referido a fenología de la fructificación en Nouragues (Guyana francesa) extraído de Mendoza *et al.* [-@Mendoza2018] y el otro a los patrones de actividad del agutí y del pecarí de la Isla de Barro Colorado [@Rowcliffe2014], extraídos del paquete `activity` `r citep(citation("activity"))`. Estos ejemplos permitirán mostrar cómo hacer representaciones gráficas circulares, calcular métricas circulares básicas y hacer inferencia sobre hipótesis de una y dos muestras. Utilizaremos R `r citep(citation())` para todos nuestros análisis, en concreto los tres paquetes de R que permiten analizar los datos circulares: `Directional` `r citep(citation("Directional"))`, `CircStats` `r citep(citation("CircStats"))`, y `circular` `r citep(citation("circular"))`, así como el paquete `ggplot2` `r citep(citation("ggplot2"))` para las representaciones gráficas. Debido a las limitaciones de espacio de esta nota, se recomienda revisar otras referencias para tener más detalle de los métodos, fórmulas exactas y aplicaciones a la Ecología de la estadística circular [@Batschelet1981; @Morellato2010; @MardiaJupp2000; @Staggemeier2020] . 

```{r librarycall, eval = TRUE, echo = TRUE, warning = FALSE, message = FALSE}
library(activity)
library(circular)
library(CircStats)
library(Directional)
library(ggplot2)
```


```{r dataexample, eval = TRUE, echo = TRUE}
aguti <- subset(activity::BCItime, species == "agouti")
pecari <- subset(activity::BCItime, species == "peccary")
#se seleccionan los datos del agutí y pecarí de la base de datos BCItime del paquete activity. El tiempo de muestreo está expresado como una proporción relativa a las 24 horas de un día.

frutofrq <- data.frame(meses = c("ene", "feb", "mar", "abr", "may", "jun", "jul", "ago", "sep", "oct", "nov", "dic"), meses.ang = seq(15, 350, 30), numspp = c(21, 23, 32, 31, 29, 20, 19, 18, 15, 17, 21, 16))  #estos datos representan el número de especies en fruto por mes en Nouragues (extraído de Mendoza et al. 2018)         
```

# Representaciones gráficas de datos circulares

El paquete `circular` `r citep(citation("circular"))` permite representar fácilmente los datos circulares que no están en frecuencias convirtiéndolos en un objeto `circular` usando la función `plot` (Fig. 1). 

```{r circaguti, echo = TRUE, eval = FALSE}
aguti.circ <- circular::circular(aguti$time*2*pi, units = "radians", template = "clock24")
pecari.circ <- circular::circular(pecari$time*2*pi, units = "radians", template = "clock24")
#convertimos en radianes los valores temporales

plot (aguti.circ, main = "aguti") #Fig. 1
plot(pecari.circ, main = "pecari")
```


Sin embargo, esta representación no es especialmente informativa. Es mucho más útil poder representar un histograma circular, en el que la longitud de cada barra representa la frecuencia de cada medida para cada ángulo (o unidad temporal). Para ello, podemos usar la función `windrose` del mismo paquete, pero la opción com mayor variedad de parámetros gráficos sin duda es a través de `ggplot2` usando la función `coord_polar`. Sin embargo, es preciso resaltar que estos diagramas de rosa tienden a [sesgar][sesgo_diagrama] al lector, sobre todo si el número de barras es bajo o el círculo interior pequeño. Se recomienda entonces usar la raiz cuadrada de las frecuencias como radios [@Zar1999].

```{r cirhist, echo = TRUE, eval = FALSE}
fig2 <- ggplot(frutofrq, aes(x = meses.ang, y = sqrt(numspp))) + geom_bar(stat='identity') + coord_polar() 
```

# Principales métricas circulares: media angular, desviación estándar angular y vector *r*

La estadística linear no sirve para calcular estadísticos de datos circulares. Para eso, se han desarrollado métricas circulares como la media, varianza y desviación estándard circulares. Para conocer los detalles de las mismas, se recomienda Zar [-@Zar1999]. Estas métricas son fácilmente calculables usando la función `circ.summary` del paquete `Directional`.

```{r circmetric, echo = TRUE, eval = TRUE}
aguti.sum <- Directional::circ.summary(aguti$time*2*pi, plot = F) 

aguti.sum$mesos #media angular en radianes

aguti.sum$circstd #desviación estándard circular en radianes

```
En el caso de datos incluyendo frecuencias (como ocurre para los datos de fruto de Nouragues), se deben convertir las frecuencias en un vector único que repite cada valor angular el número de veces de su frecuencia. Una vez conseguido este vector, se podrá aplicar la función `circ.summary` como en el caso anterior. 

```{r circmetricfreq, echo = TRUE, eval = TRUE}

fruto <- c(rep(15,21), rep(45,23), rep(75,32), rep( 105, 31), rep(135, 29), rep(165,20), rep(195,19), rep(225,18), rep(255, 15), rep(285, 17), rep(315, 21), rep(345, 16))

fruto.sum <-  Directional::circ.summary(fruto*pi/180, plot = F, rads = T) #convertimos en radianes los valores temporales

```
De estas métricas, *MRL* representa  el vector de la longitud de la media o vector *r*. Es un valor adimensional que se utiliza en fenología como una estima de la concentración de la actividad o la estacionalidad de la fenofase, siendo mayor cuanto más cercano a 1. Así por ejemplo, el valor de *r* = `r round(aguti.sum$MRL, 5)` para la actividad de los agutíes nos indica que está muy concentrada en el tiempo. En el caso de la fructificación en Nouragues, al estar los datos agrupados por meses, debemos multiplicar por un factor corrección $c<- (30*pi/360)/sin(30/2)$ al valor de *r* que se deriva de la función `circ.summary` `r c<- (30*pi/360)/sin(30/2)` *r* = `r round(fruto.sum$MRL*c, 2)`. El valor de *r* cercano a 0 para estos datos nos indica que la estacionalidad de la fructificación es muy baja. 

# Tests de uniformidad de una muestra: test de Rayleigh como medida de estacionalidad

La forma de verificar estadísticamente si una distribución circular es significativamente estacional es usando el *test de Rayleigh*. Este test tiene como hipótesis nula que la distribución circular es uniforme, es decir, que no tiene una dirección media angular. Para ello, es un requisito indispensable que la distribución sea unimodal, aunque si los datos fueran bimodales y estuvieran repartidos a lo largo del círculo, podríamos trabajar con las dos medias circunferencias por separado.

```{r rtest, echo = TRUE, eval = TRUE}
CircStats::r.test(fruto, degree = T)
CircStats::r.test(aguti$time*2*pi, degree = F)

```
Gracias a este test podemos ver que, a pesar de que el valor de *r* para Nouragues sea bajo, la fructificación es significativamente estacional, con un pico en marzo-mayo.

# Tests entre dos distribuciones circulares: test de Mardia-Watson-Wheeler aplicado a los patrones actividad de los animales

Muchas trabajos (ver `r citet("10.1007/s00265-014-1748-1")` como ejemplo) analizan los patrones de actividad diaria de diferentes especies animales usando el test de Mardia-Watson-Wheeler [@Batschelet1981]. Este test permite detectar si dos muestras circulares difieren significativamente entre sí de una forma no paramétrica. Para ello, las dos muestras se mezclan, se distribuyen uniformente y se calculan sus rangos circulares. Si las dos muestras son similares, la distribución de sus rangos también debería serlo, aceptándose la hipótesis nula.

```{r density, echo = FALSE, eval = FALSE}
dens <- density2(aguti$time, from=0.25, to=0.75)
plot(dens)
mod1 <- fitact(aguti$time * 2 * pi)
plot(mod1)

dens2 <- density2(pecari$time, from=0.25, to=0.75)
plot(dens2, main = "pecari")
mod2 <- fitact(pecari$time * 2 * pi)
plot(mod2, main = "pecari")

```
La forma más sencilla de calcular este test es usando la función `watson.wheeler.test` del paquete `circular`. 

```{r mardiatest, echo = TRUE, eval = TRUE, warning = FALSE}
aguti.circ <- circular::circular(aguti$time*2*pi, units = "radians", template = "clock24")
pecari.circ <- circular::circular(pecari$time*2*pi, units = "radians", template = "clock24")

circular::watson.wheeler.test(list(aguti.circ, pecari.circ))

```
Usamos el ejemplo de los datos de actividad del agutí y el pecarí. Como se podía apreciar por los gráficos de la Fig. 1, el test nos demuestra que el patrón de actividad de las dos especies es significativamente diferente.

# Consideraciones finales
En esta nota apenas hemos pincelado algunas aplicaciones básicas de la estadística circular  a la Ecología, especialmente para la fenología o el estudio de patrones de actividad diaria de animales, pero obviamente hay muchas más posibilidades. No hemos comentado otros tests importantes ni tampoco las correlaciones circular-linear o circular-circular por falta de espacio, por ejemplo. Gracias a la funcionalidad de los paquetes de *R* especializados en estadística circular, estas métricas y análisis están fácilmente disponibles, con lo que el usuario interesado podrá seguir avanzando en la aplicación de una poderosa herramienta estadística.

El código necesario para reproducir este documento se puede consultar en [GitHub][github_nota].

[sesgo_diagrama]: https://www.data-to-viz.com/caveat/circular_bar_yaxis.html
[github_nota]: https://github.com/iremendoza/Nota_estadistica_circular

# Agradecimientos

Esta nota es un producto del proyecto TEMPNET, financiado con una beca Marie-Sklodowska Curie (798269 - TEMPNET - H2020-MSCA-IF-2017/H2020-MSCA-IF-2017).



### REFERENCIAS

```{r write_citations, cache=FALSE, include=FALSE}
write.bibtex(file = "knitcitations_estadistica_circular.bib")
```

<div id = "refs"></div>


###### PIES DE FIGURA

**Figura 1**. Diagrama circular representando la actividad diaria del agutí y el pecarí en la Isla de Barro Colorado. (Datos extraídos de Rowcliffe *et al.* 2014).

**Figura 2**. Histograma circular representando el número de especies con fruto en cada mes del año en la reserva de Nouragues (Guyana Francesa). Datos extraídos de Mendoza *et al.* 2018. El código para representar esta figura se puede ver en el texto. 

###### FIGURA 1

```{r Fig1, echo=FALSE, fig.cap="Figura 1.", cache=FALSE, fig.fullwidth = T}
aguti.circ <- circular::circular(aguti$time*2*pi, units = "radians", template = "clock24") #convertimos en radianes los valores temporales
par(mfrow = c(1,2))
plot (aguti.circ, main = "aguti")
plot(pecari.circ, main = "pecari")
```


###### FIGURA 2

```{r Fig2, echo=FALSE, fig.cap="Figura 2.", cache=FALSE}
library(ggplot2)

ggplot(frutofrq, aes(x = meses.ang, y = sqrt(numspp))) + geom_bar(stat='identity') + coord_polar() + 
scale_y_continuous( breaks = c(0,2,4,6), labels = c("0", "4", "16", "36")) +
#ylim(0, 6.3) +
geom_text(aes(y = 6.5, label = meses))  +  xlab(label ="meses")+ ylab(label ="número de especies en fruto") + 
  theme_bw() + 
  theme(axis.text = element_text(size = 12, colour = "black"),
        axis.text.x = element_blank(),
        axis.title = element_text(size = 15, colour = "black"))


```












